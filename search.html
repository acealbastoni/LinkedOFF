<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù - LinkedOFF ğ“ğ“¬ğ“®ğ“ğ“µğ“‘ğ“ªğ“¼ğ“½ğ“¸ğ“·ğ“²</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/search.css">
    <link rel="icon" type="image/svg+xml" href="img/icon-linkedoff.svg">

    <!-- â•â•â• EARLY AUTH GUARD â€” runs before any HTML renders â•â•â• -->
    <style>body { visibility: hidden; }</style>
    <script>
      (function () {
        try {
          var user = JSON.parse(localStorage.getItem('linkedoff_user') || 'null');
          var sess = JSON.parse(localStorage.getItem('linkedoff_session') || 'null');
          if (!user || !sess || !sess.token || Date.now() > Number(sess.expiresAtMs || 0)) {
            window.location.replace('login.html');
          } else {
            document.addEventListener('DOMContentLoaded', function () {
              document.body.style.visibility = 'visible';
            });
          }
        } catch (e) { window.location.replace('login.html'); }
      })();
    </script>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <script src="js/auth.js"></script>
    <script>startSessionEnforcer();</script>
</head>

<body class="app-page" data-page="search">
<div class="app-shell">
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar(false)"></div>
  <aside class="app-sidebar" id="appSidebar" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
  <div class="sidebar-brand">
    <a href="index.html" class="brand-link">
      <span class="brand-mark">ğŸ’¼</span>
      <span class="brand-text">LinkedOFF</span>
      <span class="brand-sub">AceAlBastoni</span>
    </a>
  </div>

  <nav class="sidebar-nav">
    <a href="index.html" class="nav-item"><span class="nav-ic">ğŸ </span><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
    <a href="search.html" class="nav-item"><span class="nav-ic">ğŸ”</span><span>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</span></a>
    <a href="dashboard.html" class="nav-item"><span class="nav-ic">ğŸ“Š</span><span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
    <a href="engines-interactive.html" class="nav-item"><span class="nav-ic">âš™ï¸</span><span>Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª</span></a>
    <a href="about.html" class="nav-item"><span class="nav-ic">ğŸ‘¤</span><span>Ø¹Ù†ÙŠ</span></a>
    <a href="index.html#pricing" class="nav-item"><span class="nav-ic">ğŸ’³</span><span>Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</span></a>
  </nav>

  <!-- Daily Counter Widget -->
  <div id="dailySentWidget" style="
    margin:0 12px 10px;padding:10px 14px;
    background:rgba(0,168,89,.13);border-radius:10px;
    border:1px solid rgba(0,168,89,.25);
    opacity:0.5;transition:opacity .3s;
  ">
    <div style="font-size:12px;color:#888;margin-bottom:4px;font-family:'Cairo',sans-serif;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…</div>
    <div style="display:flex;align-items:center;gap:8px;">
      <span style="font-size:22px;font-weight:900;color:#00A859;font-family:'Cairo',sans-serif;" id="dailySentCount">0</span>
      <span style="font-size:12px;color:#666;font-family:'Cairo',sans-serif;">Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ù…Ø±Ø³Ù„Ø©</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="sidebar-logout" type="button" onclick="performLogout('ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', false)">
      <span class="nav-ic">ğŸšª</span><span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
    </button>
  </div>
</aside>
  <div class="app-main">
    <header class="app-topbar">
      <button class="sidebar-toggle" type="button" aria-label="ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" onclick="toggleSidebar()">
        <span class="toggle-bars"></span>
      </button>
      <!-- <div class="topbar-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</div> -->
      <div class="topbar-actions">
        <button id="darkModeBtn" onclick="toggleDarkMode()" title="ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ" style="
          background:none;border:1px solid #ddd;border-radius:8px;
          padding:6px 10px;cursor:pointer;font-size:18px;line-height:1;
          transition:background .2s,border-color .2s;
        ">ğŸŒ™</button>
      </div>
    </header>

    <main class="app-content">
<!-- Search Section -->
    <section class="search-section">
        <div class="container">
            <h1 class="page-title">ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØ© Ø£Ø­Ù„Ø§Ù…Ùƒ</h1>
            <p class="page-subtitle">Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù„ÙŠÙˆÙ† ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>

            <!-- Search Filters -->
            <div class="search-filters">
                <div class="filter-row">
                    <input type="text" id="searchKeyword" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©... (Ù…Ø«Ø§Ù„: Ù…Ù‡Ù†Ø¯Ø³ØŒ Ù…Ø­Ø§Ø³Ø¨ØŒ Ù…Ø¨ÙŠØ¹Ø§Øª)"
                           onkeydown="if(event.key==='Enter') searchJobs()">
                    <button class="btn-primary" onclick="searchJobs()">Ø¨Ø­Ø«</button>
                </div>

                <div class="advanced-filters" id="advancedFilters">
                    <div class="filter-group">
                        <label>ğŸ“ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                        <select id="cityFilter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†</option>
                            <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                            <option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
                            <option value="Ø§Ù„Ø¯Ù…Ø§Ù…">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                            <option value="Ù…ÙƒØ©">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                            <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                            <option value="Ø§Ù„Ø®Ø¨Ø±">Ø§Ù„Ø®Ø¨Ø±</option>
                            <option value="Ø§Ù„Ø·Ø§Ø¦Ù">Ø§Ù„Ø·Ø§Ø¦Ù</option>
                            <option value="ØªØ¨ÙˆÙƒ">ØªØ¨ÙˆÙƒ</option>
                            <option value="Ø£Ø¨Ù‡Ø§">Ø£Ø¨Ù‡Ø§</option>
                            <option value="Ø­Ø§Ø¦Ù„">Ø­Ø§Ø¦Ù„</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>ğŸ’¼ Ø§Ù„Ù…Ø¬Ø§Ù„:</label>
                        <select id="fieldFilter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</option>
                            <option value="ØªÙ‚Ù†ÙŠØ©">ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                            <option value="Ù…Ø¨ÙŠØ¹Ø§Øª">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„ØªØ³ÙˆÙŠÙ‚</option>
                            <option value="Ù‡Ù†Ø¯Ø³Ø©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</option>
                            <option value="Ù…Ø­Ø§Ø³Ø¨Ø©">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                            <option value="Ø·Ø¨">Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø·Ø¨</option>
                            <option value="ØªØ¹Ù„ÙŠÙ…">Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨</option>
                            <option value="Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                            <option value="Ù…ÙˆØ§Ø±Ø¯">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø¯Ù†Ù‰:</label>
                        <select id="salaryFilter">
                            <option value="0">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
                            <option value="3000">3,000+ Ø±ÙŠØ§Ù„</option>
                            <option value="5000">5,000+ Ø±ÙŠØ§Ù„</option>
                            <option value="8000">8,000+ Ø±ÙŠØ§Ù„</option>
                            <option value="10000">10,000+ Ø±ÙŠØ§Ù„</option>
                            <option value="15000">15,000+ Ø±ÙŠØ§Ù„</option>
                            <option value="20000">20,000+ Ø±ÙŠØ§Ù„</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>ğŸ“… Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯:</label>
                        <select id="contractFilter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                            <option value="Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„">Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„</option>
                            <option value="Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ">Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ</option>
                            <option value="Ù…Ø¤Ù‚Øª">Ù…Ø¤Ù‚Øª</option>
                            <option value="Ø¹Ù† Ø¨Ø¹Ø¯">Ø¹Ù† Ø¨Ø¹Ø¯</option>
                        </select>
                    </div>

                    <div class="filter-group filter-group--wide">
                        <label>âœ… ÙƒÙ„Ù…Ø§Øª ÙŠØ¬Ø¨ ØªÙˆØ§ÙØ±Ù‡Ø§ ÙƒÙ„Ù‡Ø§ (AND):</label>
                        <input type="text" id="mustIncludeFilter"
                               placeholder="Ù…Ø«Ø§Ù„: pythonØŒ seniorØŒ remote  (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø© Ø£Ùˆ Ù…Ø³Ø§ÙØ©)"
                               title="ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø§Øª">
                    </div>

                    <div class="filter-group filter-group--wide">
                        <label>ğŸš« ÙƒÙ„Ù…Ø§Øª ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯Ù‡Ø§ (NOT):</label>
                        <input type="text" id="mustExcludeFilter"
                               placeholder="Ù…Ø«Ø§Ù„: juniorØŒ internship  (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø© Ø£Ùˆ Ù…Ø³Ø§ÙØ©)"
                               title="ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø£ÙŠ ÙˆØ¸ÙŠÙØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø§Øª">
                    </div>
                </div>

                <div class="filter-actions">
                    <button onclick="toggleAdvancedFilters()" class="btn-outline">âš™ï¸ ÙÙ„ØªØ± Ù…ØªÙ‚Ø¯Ù…</button>
                    <button onclick="resetFilters()" class="btn-outline">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    <button onclick="exportResults()" class="btn-outline">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
                </div>
            </div>

            <!-- Results Info -->
            <div class="results-info" id="resultsInfo">
                <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>

            <!-- Jobs List -->
            <div class="jobs-container" id="jobsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination"></div>
        </div>
    </section>

    <!-- Subscription Modal -->
    <div class="modal" id="subscriptionModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>ğŸ”’ Ù…Ø­ØªÙˆÙ‰ Ø­ØµØ±ÙŠ Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h2>
            <p>Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ÙƒØ§Ù…Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ØŒ ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</p>
            <div class="modal-plans">
                <div class="modal-plan">
                    <h3>Basic</h3>
                    <p class="modal-price">99 Ø±ÙŠØ§Ù„/Ø´Ù‡Ø±</p>
                    <a href="index.html#pricing" class="btn-primary">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</a>
                </div>
                <div class="modal-plan popular-modal">
                    <span class="popular-tag">Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹</span>
                    <h3>Pro</h3>
                    <p class="modal-price">199 Ø±ÙŠØ§Ù„/Ø´Ù‡Ø±</p>
                    <a href="index.html#pricing" class="btn-primary">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</a>
                </div>
                <div class="modal-plan">
                    <h3>Premium</h3>
                    <p class="modal-price">399 Ø±ÙŠØ§Ù„/Ø´Ù‡Ø±</p>
                    <a href="index.html#pricing" class="btn-primary">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>
                        <img src="img/logo-linkedoff.svg"
                             alt="LinkedOFF AceAlBastoni"
                             style="height:40px; vertical-align:middle;">
                    </h3>
                    
                    <p>Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© Ù„Ù„ÙˆØ¸Ø§Ø¦Ù ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
                </div>
                <div class="footer-section">
                    <h4>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
                    <p>ğŸ“± WhatsApp: 0566114725</p>
                    <p>ğŸ’š STC Pay: 0566114725</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p id="copyrightText">&copy; 2024 LinkedOFF AceAlBastoni. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
                <p class="footer-version" id="footerVersion">v1.2.0 - 25 Ø¯ÙŠØ³Ù…Ø¨Ø± 2024</p>
            </div>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/search.js"></script>

    <!-- Version Badge -->
    <div class="version-badge" id="versionBadge">v1.2.0</div>
<!-- Session Message Modal -->
<div id="sessionModal" class="session-modal hidden">
    <div class="session-box">
      <div class="session-icon">â³</div>
      <h3 id="sessionTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h3>
      <p id="sessionMessage"></p>
      <button onclick="closeSessionModal()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
    </main>
  </div>
</div>

<script>
  // Highlight active sidebar link
  (function() {
    try {
      const current = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
      document.querySelectorAll('.sidebar-nav .nav-item').forEach(a => {
        const href = (a.getAttribute('href') || '').toLowerCase();
        if (href === current) a.classList.add('active');
      });
    } catch(e) {}
  })();

  // Init dark mode + daily counter on load
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof initDarkMode       === 'function') initDarkMode();
    if (typeof updateDailyCounterUI === 'function') updateDailyCounterUI();
  });
</script>




<!-- Global Send Progress Bar -->
<div id="sendProgressBar" style="
  position:fixed; bottom:0; left:0; right:0; z-index:10000;
  background:linear-gradient(90deg,#1a7f4b,#27ae60);
  color:#fff; font-family:'Cairo',sans-serif; font-size:14px; font-weight:600;
  display:flex; align-items:center; gap:12px; padding:10px 20px;
  box-shadow:0 -3px 16px rgba(0,0,0,.2);
  transform:translateY(100%); transition:transform .3s ease;
  pointer-events:none;
">
  <span style="
    width:18px;height:18px;flex-shrink:0;
    border:3px solid rgba(255,255,255,.35);
    border-top-color:#fff; border-radius:50%;
    animation:btnSpin .7s linear infinite;
    display:inline-block;
  "></span>
  <span id="sendProgressMsg">Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©...</span>
  <span style="margin-right:auto;font-size:12px;opacity:.8;">Ù„Ø§ ØªØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø©</span>
</div>

<!-- Toast Notification -->
<div id="appToast" style="
  position:fixed; top:24px; left:50%; transform:translateX(-50%) translateY(-80px);
  min-width:280px; max-width:420px; padding:14px 20px;
  border-radius:12px; box-shadow:0 8px 28px rgba(0,0,0,.18);
  display:flex; align-items:center; gap:12px;
  font-family:'Cairo',sans-serif; font-size:15px; font-weight:600;
  color:#fff; z-index:9999; transition:transform .35s cubic-bezier(.34,1.56,.64,1), opacity .3s;
  opacity:0; pointer-events:none;
">
  <span id="appToastIcon" style="font-size:22px;flex-shrink:0;"></span>
  <span id="appToastMsg" style="flex:1;line-height:1.5;"></span>
  <button onclick="hideToast()" style="
    background:rgba(255,255,255,.25); border:none; color:#fff;
    border-radius:6px; padding:2px 8px; cursor:pointer; font-size:13px;
    font-family:'Cairo',sans-serif; margin-right:4px;
  ">âœ•</button>
</div>

<!-- Coming Soon Modal -->
<div id="comingSoonModal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-icon">ğŸš§</div>
        <h3>Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</h3>
        <p>
            Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ
            ÙˆÙŠØ¬Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡Ø§ Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨ØªÙƒ.
        </p>
        <button onclick="closeComingSoon()">Ø­Ø³Ù†Ù‹Ø§</button>
    </div>
</div>

<script>
  function showSendProgress(toEmail) {
    const bar = document.getElementById('sendProgressBar');
    const msg = document.getElementById('sendProgressMsg');
    const domain = toEmail ? '@' + toEmail.split('@')[1] : '';
    msg.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©' + (domain ? ' Ø¥Ù„Ù‰ ' + domain : '') + '...';
    bar.style.transform = 'translateY(0)';
  }

  function hideSendProgress() {
    document.getElementById('sendProgressBar').style.transform = 'translateY(100%)';
  }

  let _toastTimer = null;

  function showToast(message, type = 'success') {
    const toast   = document.getElementById('appToast');
    const icon    = document.getElementById('appToastIcon');
    const msg     = document.getElementById('appToastMsg');

    const styles = {
      success: { bg: '#1a7f4b', ico: 'âœ”' },
      error:   { bg: '#c0392b', ico: 'âœ–' },
      info:    { bg: '#1a5276', ico: 'â„¹' },
    };
    const s = styles[type] || styles.info;

    toast.style.background = s.bg;
    icon.textContent        = s.ico;
    msg.textContent         = message;

    toast.style.opacity     = '1';
    toast.style.pointerEvents = 'auto';
    toast.style.transform   = 'translateX(-50%) translateY(0)';

    clearTimeout(_toastTimer);
    _toastTimer = setTimeout(hideToast, 5000);
  }

  function hideToast() {
    const toast = document.getElementById('appToast');
    toast.style.opacity     = '0';
    toast.style.pointerEvents = 'none';
    toast.style.transform   = 'translateX(-50%) translateY(-80px)';
  }

  function showComingSoon() {
    document.getElementById('comingSoonModal').style.display = 'flex';
  }

  async function applyNow(btn) {
    const realEmail = btn?.dataset?.email;

    if (!realEmail || realEmail === 'ØºÙŠØ± Ù…ØªÙˆÙØ±') {
      showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ©.', 'error');
      return;
    }

    const originalHTML = btn.innerHTML;
    btn.disabled  = true;
    btn.innerHTML = '<span style="display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:btnSpin .7s linear infinite;vertical-align:middle;margin-left:6px;"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

    showSendProgress(realEmail);

    try {
      const data = await authRequest('sendcv', { toEmail: realEmail });
      const quotaMsg = data.remainingQuota !== undefined ? ` â€” Ù…ØªØ¨Ù‚ÙŠ: ${data.remainingQuota} Ø¥ÙŠÙ…ÙŠÙ„` : '';
      showToast((data.message || 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!') + quotaMsg, 'success');

      // â”€â”€ Track applied job â”€â”€
      if (typeof markJobAsApplied === 'function') markJobAsApplied(realEmail);
      if (typeof incrementDailySent === 'function') incrementDailySent();

      // â”€â”€ Update button to "applied" state without re-rendering â”€â”€
      btn.className   = 'btn-applied';
      btn.innerHTML   = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€” Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ';
      btn.disabled    = false;

      // â”€â”€ Add green border to card â”€â”€
      const card = btn.closest('.job-card');
      if (card) {
        card.classList.add('applied');
        const titleEl = card.querySelector('.job-title');
        if (titleEl && !titleEl.querySelector('.applied-badge')) {
          const badge = document.createElement('span');
          badge.className   = 'applied-badge';
          badge.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
          titleEl.prepend(badge);
        }
      }

    } catch (err) {
      console.error(err);
      const quotaMsg = err.remainingQuota !== undefined ? ` â€” Ù…ØªØ¨Ù‚ÙŠ: ${err.remainingQuota} Ø¥ÙŠÙ…ÙŠÙ„` : '';
      showToast('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + err.message + quotaMsg, 'error');
    } finally {
      if (!btn.classList.contains('btn-applied')) {
        btn.disabled  = false;
        btn.innerHTML = originalHTML;
      }
      hideSendProgress();
    }
  }

  function closeComingSoon() {
    document.getElementById('comingSoonModal').style.display = 'none';
  }
</script>

<style>
  @keyframes btnSpin { to { transform: rotate(360deg); } }

  /* â”€â”€ Applied Job Card â”€â”€ */
  .job-card.applied {
    border-right: 4px solid #00A859 !important;
    background: linear-gradient(135deg, #f0fff6 0%, #fff 60%) !important;
  }
  .applied-badge {
    display:inline-block;background:#00A859;color:#fff;
    font-size:11px;font-weight:700;padding:2px 8px;border-radius:20px;
    margin-left:6px;vertical-align:middle;
  }
  .applied-meta {
    color:#00A859 !important;font-size:12px;font-weight:600;
  }
  .btn-applied {
    background: linear-gradient(135deg,#e8f5e9,#c8e6c9);
    color:#2e7d32;border:1.5px solid #a5d6a7;
    padding:8px 16px;border-radius:8px;font-family:'Cairo',sans-serif;
    font-size:13px;font-weight:700;cursor:pointer;
    transition:all .2s;
  }
  .btn-applied:hover {
    background:linear-gradient(135deg,#00A859,#00c86a);
    color:#fff;border-color:#00A859;
  }
  .btn-copy-email {
    padding:8px 12px !important;font-size:15px !important;min-width:unset !important;
  }
  .btn-copy-email:hover { background:#e3f2fd !important; }

  /* â”€â”€ Dark Mode â”€â”€ */
  body.dark-mode { background:#121212 !important; color:#e0e0e0 !important; }
  body.dark-mode .app-sidebar     { background:#1e1e1e !important; border-color:#333 !important; }
  body.dark-mode .app-topbar      { background:#1e1e1e !important; border-color:#333 !important; }
  body.dark-mode .app-main        { background:#121212 !important; }
  body.dark-mode .job-card        { background:#1e1e1e !important; border-color:#333 !important; color:#e0e0e0 !important; }
  body.dark-mode .job-card.applied{ background:linear-gradient(135deg,#1a2e1e,#1e1e1e) !important; }
  body.dark-mode .search-filters  { background:#1e1e1e !important; border-color:#333 !important; }
  body.dark-mode input, body.dark-mode select {
    background:#2a2a2a !important; color:#e0e0e0 !important;
    border-color:#444 !important;
  }
  body.dark-mode .btn-outline     { border-color:#555 !important; color:#ccc !important; }
  body.dark-mode .btn-outline:hover { background:#2a2a2a !important; }
  body.dark-mode .job-description { color:#ccc !important; }
  body.dark-mode .job-meta span   { color:#aaa !important; }
  body.dark-mode .job-source      { background:#333 !important; color:#aaa !important; }
  body.dark-mode .footer          { background:#1a1a1a !important; border-color:#333 !important; }
  body.dark-mode #darkModeBtn     { border-color:#555 !important; }
  body.dark-mode .nav-item        { color:#ccc !important; }
  body.dark-mode .nav-item:hover,
  body.dark-mode .nav-item.active { background:#2a2a2a !important; color:#00A859 !important; }
  body.dark-mode #dailySentWidget { background:rgba(0,168,89,.08) !important; border-color:rgba(0,168,89,.2) !important; }
  body.dark-mode .sidebar-logout  { color:#ccc !important; }
  body.dark-mode .sidebar-logout:hover { background:#2a2a2a !important; }
  body.dark-mode .page-title,
  body.dark-mode .page-subtitle   { color:#e0e0e0 !important; }
</style>
    </body>
    
</body>
</html>
